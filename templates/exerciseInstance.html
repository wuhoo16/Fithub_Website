{% extends 'base.html' %}

<!-- NOTE THAT LOGIC HAS BEEN IMPROVED SO NOW ONLY THE EXERCISE OBJECT IS PASSED IN (not the whole array) -->
<!-- REDUCES STORAGE AND RUNTIME FOR RENDERING THIS HTML PAGE -->
<!-- Exercise Object parameter is named e -->
<!-- 2D related indices list parameter is named relatedObjects -->

{% block head %}
    <title>{{e.name}}</title>
{% endblock %}

{% block body %}
<div class="exercise-instance-div container-fluid mx-auto">
  <div class="jumbotron-exercise-instance jumbotron jumbotron-fluid text-center">
    <h1>{{ e.name }}</h1>
  </div>

  <!-- Carousel for Images -->
  <div id="myCarousel" class="carousel slide centered" data-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active" style="height: 400px;">
        <img
          src="{{ e.images[0] }}"
          style="width: auto; max-height: 400px; background-color: whitesmoke;"
          onerror="this.onerror=null; this.src='/static/exercise_backup.jpg'"
          alt="{{ e.name }}"
        />
      </div>
      {% for i in range(1, e.images|length) %}
        <div class="carousel-item"  style="height: 400px;">
            <img
            src="{{ e.images[i] }}"
            style="width: auto; max-height: 400px; background-color: whitesmoke;"
            onerror="this.onerror=null; this.src='/static/exercise_backup.jpg'"
            alt="{{ e.name }}"
            />
        </div>
      {% endfor %}
    </div>
    <a class="carousel-control-prev" href="#myCarousel" data-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </a>
    <a class="carousel-control-next" href="#myCarousel" data-slide="next">
      <span class="carousel-control-next-icon"></span>
    </a>
  </div>

  <br>

  <div class="exercise-instance-text container-fluid text-center">
    <div class="jumbotron-exercise-instance-text jumbotron jumbotron-fluid text-center">
      <h4 id="exerciseDescriptionText" >{{ e.description }}</h4>
    </div>
    <div class="jumbotron-exercise-instance-text jumbotron jumbotron-fluid text-center">
      <div class="row">
        <div class="col-sm-6">
          <h4 id="exerciseCategoryText" class="category-text"><b><u>Category:</u> </b>{{ e.category }}</h4>
        </div>
        <div class="col-sm-6">
          <h4 id="exerciseEquipmentText" class="equipment-text"><b><u>Equipment:</u> </b>{{ e.equipment|join(', ') }}</h4>
        </div>
      </div>
    </div>
    {% if e.muscles %}
        <h4><b><u>Muscles:</u> </b>{{ e.muscles }}</h4>
    {% else %}
        <h4><b><u>Muscles:</u> </b>None</h4>
    {% endif %}
    {% if e.muscles_secondary %}
        <h4><b><u>Secondary Muscles:</u> </b>{{ e.muscles_secondary }}</h4>
    {% else %}
        <h4><b><u>Secondary Muscles:</u> </b>None</h4>
    {% endif %}
    {% if e.comments %}
        <h4><b><u>Comments:</u> </b></h4>
        {% for c in e.comments %}
            <h4>{{ c }}</h4>
        {% endfor %}
    {% else %}
        <h4><b><u>Comments:</u> </b>None</h4>
    {% endif %}
  </div>

  <hr><hr>

  <div class="tables">
    <!-- Related exercises, equipment, and channel instances -->
    <!-- Related exercises table -->
    <h4 class="instance-text">Related Exercise Pages: </h4>
    <table class="table table-striped table-hover table-sm">
      {% if e.subcategory is none %}
      <caption>Exercise pages are related by category {{ e.category }}</caption>
      {% else %}
      <caption>Exercise pages are related by {{ e.category }}: {{ e.subcategory }}</caption>
      {% endif %}
      <thead class="thead-dark">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Exercise Name</th>
          <th scope="col">Page URL</th>
        </tr>
      </thead>
      <tbody>
      {% for obj in relatedObjects[0] %}
        <tr id="exerciseTable1" class="table-secondary">
            <th scope="row">{{ loop.index }}</th>
            <th scope="row">{{ obj.name }}</th>
            <td><a href="{{ url_for('exercise_instance', arrayIndex=obj.arrayIndex) }}">Link</a></td>
          </tr>
      {% endfor %}
    </table>

    <!-- Related equipment table -->
    <h4 class="instance-text">Related Equipment Pages: </h4>
    <table class="table table-striped table-hover table-sm">
      <caption>Equipment pages are related by category {{ e.equipment|join(', ') }}</caption>
      <thead class="thead-dark">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Equipment Name</th>
          <th scope="col">Page URL</th>
        </tr>
      </thead>
      <tbody>
      {% for obj in relatedObjects[1] %}
        <tr class="table-secondary">
            <th scope="row">{{ loop.index }}</th>
            <th scope="row">{{ obj.name }}</th>
            <td><a href="{{ url_for('equipment_instance', arrayIndex=obj.arrayIndex) }}">Link</a></td>
        </tr>
      {% endfor %}
      {% if relatedObjects[1]|length == 0 %}
        <tr id="exerciseTable2" class="table-secondary">
            <th scope="row">0</th>
            <th scope="row">Sorry! Looks like this exercise has no related equipment. This could be a bodyweight or calisthenics exercise!</th>
            <td>NA</td>
        </tr>
      {% endif %}

    </table>

    <!-- Related channels table -->
    <h4 class="instance-text">Related Channel Pages: </h4>
    <table class="table table-striped table-hover table-sm">
      {% if e.subcategory is none %}
      <caption>Channel pages are related by category {{ e.category }}</caption>
      {% else %}
      <caption>Channel pages are related by category {{ e.category }}: {{ e.subcategory }}</caption>
      {% endif %}
      <thead class="thead-dark">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Channel Name</th>
          <th scope="col">Page URL</th>
        </tr>
      </thead>
      <tbody>
      {% for obj in relatedObjects[2] %}
        <tr id="exerciseTable3" class="table-secondary">
            <th scope="row">{{ loop.index }}</th>
            <th scope="row">{{ obj.name }}</th>
            <td><a href="{{ url_for('channel_instance', arrayIndex=obj.arrayIndex) }}">Link</a></td>
        </tr>
      {% endfor %}
    </table>
  </div>
</div>
{% endblock %}