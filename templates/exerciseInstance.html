{% extends 'base.html' %}

<!-- NOTE THAT LOGIC HAS BEEN IMPROVED SO NOW ONLY THE EXERCISE OBJECT IS PASSED IN (not the whole array) -->
<!-- REDUCES STORAGE AND RUNTIME FOR RENDERING THIS HTML PAGE -->
<!-- Exercise Object parameter is named e -->
<!-- 2D related indices list parameter is named relatedObjects -->

{% block head %}
    <title>{{e.name}}</title>
{% endblock %}

{% block body %}
<div class="container-fluid bg-light mx-auto">
  <div id="exerciseInstanceHeaderRow" class="container justify-content-center align-items-center"></div>
    <h1 class="text-center" style="margin-bottom: 1em;">{{ e.name }}</h1>
  </div>
  <!-- Carousel for Images -->
  <div id="myCarousel" class="carousel slide centered" data-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img
          src="{{ e.images[0] }}"
          style="width:auto; max-height: 500px;"
          onerror="this.onerror=null; this.src='/static/exercise_backup.jpg'"
          alt="{{ e.name }}"
        />
      </div>
      {% for i in range(1, e.images|length) %}
        <div class="carousel-item">
            <img
            src="{{ e.images[i] }}"
            style="width:auto; max-height: 500px;"
            onerror="this.onerror=null; this.src='/static/exercise_backup.jpg'"
            alt="{{ e.name }}"
            />
        </div>
      {% endfor %}
    </div>
    <a class="carousel-control-prev" href="#myCarousel" data-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </a>
    <a class="carousel-control-next" href="#myCarousel" data-slide="next">
      <span class="carousel-control-next-icon"></span>
    </a>
  </div>

  <br>

  <div class="container-fluid">
    <h4><b>Description: </b>{{ e.description }}</h4>
    <h4><b>Category: </b>{{ e.category }}</h4>
    <h4><b>Equipment: </b>{{ e.equipment|join(', ') }}</h4>
    {% if e.muscles %}
        <h4><b>Muscles: </b>{{ e.muscles }}</h4>
    {% else %}
        <h4><b>Muscles: </b>None listed</h4>
    {% endif %}
    {% if e.muscles_secondary %}
        <h4><b>Secondary Muscles: </b>{{ e.muscles_secondary }}</h4>
    {% else %}
        <h4><b>Secondary Muscles: </b>None listed</h4>
    {% endif %}
    {% if e.comments %}
        <h4><b>Comments: </b></h4>
        {% for c in e.comments %}
            <h4>{{ c }}</h4>
        {% endfor %}
    {% else %}
        <h4><b>Comments: </b>None</h4>
    {% endif %}

  </div>

  <hr>

  <!-- Related exercises, equipment, and channel instances -->
  <!-- Related exercises table -->
  <table class="table table-striped table-hover table-sm">
    {% if e.subcategory is none %}
    <caption>List of other exercise pages related to {{ e.category }}</caption>
    {% else %}
    <caption>List of other exercise pages related to {{ e.category }}: {{ e.subcategory }}</caption>
    {% endif %}
    <thead class="thead-dark">
      <tr>
        <th scope="col">#</th>
        <th scope="col">Exercise Name</th>
        <th scope="col">Page URL</th>
      </tr>
    </thead>
    <tbody>
    {% for obj in relatedObjects[0] %}
      <tr>
          <th scope="row">{{ loop.index }}</th>
          <th scope="row">{{ obj.name }}</th>
          <td><a href="{{ url_for('exercise_instance', arrayIndex=obj.arrayIndex) }}">Link</a></td>
      </tr>
    {% endfor %}
  </table>

  <hr>

  <!-- Related equipment table -->
  <table class="table table-striped table-hover table-sm">
    <caption>List of equipment pages under the category {{ e.equipment }}</caption>
    <thead class="thead-dark">
      <tr>
        <th scope="col">#</th>
        <th scope="col">Equipment Name</th>
        <th scope="col">Page URL</th>
      </tr>
    </thead>
    <tbody>
    {% for obj in relatedObjects[1] %}
      <tr>
          <th scope="row">{{ loop.index }}</th>
          <th scope="row">{{ obj.name }}</th>
          <td><a href="{{ url_for('equipment_instance', arrayIndex=obj.arrayIndex) }}">Link</a></td>
      </tr>
    {% endfor %}
    {% if relatedObjects[1]|length == 0 %}
      <tr>
          <th scope="row">0</th>
          <th scope="row">Sorry! Looks like this exercise has no related equipment. This could be a bodyweight or calisthenics exercise!</th>
          <td>NA</td>
      </tr>
    {% endif %}

  </table>

  <hr>

  <!-- Related channels table -->
  <table class="table table-striped table-hover table-sm">
    {% if e.subcategory is none %}
    <caption>List of channel pages related to {{ e.category }}</caption>
    {% else %}
    <caption>List of channel pages related to {{ e.category }}: {{ e.subcategory }}</caption>
    {% endif %}
    <thead class="thead-dark">
      <tr>
        <th scope="col">#</th>
        <th scope="col">Channel Name</th>
        <th scope="col">Page URL</th>
      </tr>
    </thead>
    <tbody>
    {% for obj in relatedObjects[2] %}
      <tr>
          <th scope="row">{{ loop.index }}</th>
          <th scope="row">{{ obj.name }}</th>
          <td><a href="{{ url_for('channel_instance', arrayIndex=obj.arrayIndex) }}">Link</a></td>
      </tr>
    {% endfor %}
  </table>
</div>
{% endblock %}